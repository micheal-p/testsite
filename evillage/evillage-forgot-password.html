<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password | eVillage Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css?v=2.0">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0d3d44 0%, #0a2e33 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .reset-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 480px;
            width: 100%;
            padding: 60px;
            position: relative;
            overflow: hidden;
        }

        .logo-link {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            text-decoration: none;
            color: #0d3d44;
            font-weight: 600;
            font-size: 18px;
        }

        .logo-link i {
            font-size: 24px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary, #6b7280);
            text-decoration: none;
            margin-bottom: 24px;
            transition: color 0.2s;
            font-weight: 500;
        }

        .back-link:hover {
            color: #0d3d44;
        }

        /* Steps */
        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-header {
            margin-bottom: 32px;
        }

        .step-header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary, #111827);
        }

        .step-header p {
            font-size: 15px;
            color: var(--text-secondary, #6b7280);
            line-height: 1.6;
        }

        /* Icon header */
        .step-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 24px;
        }

        .step-icon.email {
            background: rgba(13, 61, 68, 0.08);
            color: #0d3d44;
        }

        .step-icon.otp {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .step-icon.lock {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .step-icon.check {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        /* Form */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary, #111827);
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid var(--border-color, #e5e7eb);
            border-radius: 8px;
            font-family: inherit;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #0d3d44;
            box-shadow: 0 0 0 3px rgba(13, 61, 68, 0.1);
        }

        .password-wrapper {
            position: relative;
        }

        .password-wrapper input {
            padding-right: 48px;
        }

        .toggle-password {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary, #6b7280);
            font-size: 16px;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .toggle-password:hover {
            color: var(--text-primary, #111827);
        }

        /* OTP Input Group */
        .otp-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .otp-input {
            width: 52px;
            height: 56px;
            text-align: center;
            font-size: 22px;
            font-weight: 600;
            border: 2px solid var(--border-color, #e5e7eb);
            border-radius: 10px;
            font-family: inherit;
            transition: all 0.2s;
            color: var(--text-primary, #111827);
        }

        .otp-input:focus {
            outline: none;
            border-color: #0d3d44;
            box-shadow: 0 0 0 3px rgba(13, 61, 68, 0.1);
        }

        .otp-input.filled {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.04);
        }

        /* Password strength */
        .password-strength {
            margin-top: 12px;
        }

        .strength-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .strength-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s, background 0.3s;
            width: 0;
        }

        .strength-text {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary, #6b7280);
        }

        .password-requirements {
            margin-top: 16px;
            padding: 0;
            list-style: none;
        }

        .password-requirements li {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary, #6b7280);
            margin-bottom: 6px;
            transition: color 0.2s;
        }

        .password-requirements li i {
            font-size: 12px;
            width: 16px;
            text-align: center;
        }

        .password-requirements li.met {
            color: #10b981;
        }

        .password-requirements li.met i {
            color: #10b981;
        }

        /* Buttons */
        .submit-btn {
            width: 100%;
            padding: 14px 32px;
            font-size: 15px;
            font-weight: 600;
            color: white;
            background: #0d3d44;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .submit-btn:hover {
            background: #0a2e33;
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .resend-link {
            display: block;
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: var(--text-secondary, #6b7280);
        }

        .resend-link a {
            color: #0d3d44;
            font-weight: 600;
            text-decoration: none;
        }

        .resend-link a:hover {
            text-decoration: underline;
        }

        .timer {
            font-variant-numeric: tabular-nums;
            color: var(--text-secondary, #6b7280);
            font-weight: 500;
        }

        /* Success state */
        .success-check {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .success-check i {
            font-size: 32px;
            color: #10b981;
        }

        .step-4 .step-header {
            text-align: center;
        }

        /* Progress indicator */
        .progress-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 32px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s;
        }

        .progress-dot.active {
            width: 24px;
            border-radius: 4px;
            background: #0d3d44;
        }

        .progress-dot.done {
            background: #10b981;
        }

        /* Mobile */
        @media (max-width: 640px) {
            .reset-card {
                padding: 40px 24px;
            }

            .step-header h1 {
                font-size: 24px;
            }

            .otp-input {
                width: 44px;
                height: 48px;
                font-size: 18px;
            }
        }

        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #001D21 0%, #002329 100%);
        }

        body.dark-mode .reset-card {
            background: #003540;
        }

        body.dark-mode .logo-link {
            color: white;
        }

        body.dark-mode .back-link {
            color: rgba(255, 255, 255, 0.6);
        }

        body.dark-mode .back-link:hover {
            color: #10b981;
        }

        body.dark-mode .step-header h1 {
            color: white;
        }

        body.dark-mode .step-header p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.dark-mode .form-group label {
            color: white;
        }

        body.dark-mode .form-group input,
        body.dark-mode .otp-input {
            background: #004552;
            color: white;
            border-color: rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .submit-btn {
            background: #10b981;
        }

        body.dark-mode .submit-btn:hover {
            background: #059669;
        }

        body.dark-mode .progress-dot {
            background: rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .progress-dot.active {
            background: #10b981;
        }

        body.dark-mode .resend-link a {
            color: #10b981;
        }
    </style>
</head>

<body>
    <div class="reset-card">
        <a href="evillage.html" class="logo-link">
            <i class="fas fa-leaf"></i>
            <span>eVillage Portal</span>
        </a>

        <!-- Progress Dots -->
        <div class="progress-dots">
            <div class="progress-dot active" id="dot1"></div>
            <div class="progress-dot" id="dot2"></div>
            <div class="progress-dot" id="dot3"></div>
        </div>

        <!-- STEP 1: Enter Email -->
        <div class="step active" id="step1">
            <a href="evillage-signin.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to sign in
            </a>

            <div class="step-icon email">
                <i class="fas fa-envelope"></i>
            </div>

            <div class="step-header">
                <h1>Reset your password</h1>
                <p>Enter the email address associated with your account and we'll send you a verification code.</p>
            </div>

            <form onsubmit="event.preventDefault(); sendCode();">
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" id="resetEmail" name="email" placeholder="you@example.com" required autofocus>
                </div>
                <button type="submit" class="submit-btn" id="sendBtn">Send Verification Code</button>
            </form>
        </div>

        <!-- STEP 2: Enter OTP -->
        <div class="step" id="step2">
            <a href="#" onclick="event.preventDefault(); goToStep(1);" class="back-link">
                <i class="fas fa-arrow-left"></i> Change email
            </a>

            <div class="step-icon otp">
                <i class="fas fa-shield-halved"></i>
            </div>

            <div class="step-header">
                <h1>Check your email</h1>
                <p>We sent a 6-digit verification code to <strong id="emailDisplay"></strong></p>
            </div>

            <form onsubmit="event.preventDefault(); verifyCode();">
                <div class="otp-group">
                    <input type="text" class="otp-input" maxlength="1" data-index="0" inputmode="numeric" autofocus>
                    <input type="text" class="otp-input" maxlength="1" data-index="1" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" data-index="2" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" data-index="3" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" data-index="4" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" data-index="5" inputmode="numeric">
                </div>
                <button type="submit" class="submit-btn" id="verifyBtn">Verify Code</button>
            </form>

            <div class="resend-link">
                <span id="resendArea">
                    Didn't receive the code? <span class="timer" id="timer">Resend in 0:30</span>
                </span>
            </div>
        </div>

        <!-- STEP 3: New Password -->
        <div class="step" id="step3">
            <div class="step-icon lock">
                <i class="fas fa-lock"></i>
            </div>

            <div class="step-header">
                <h1>Create new password</h1>
                <p>Your new password must be different from previously used passwords.</p>
            </div>

            <form onsubmit="event.preventDefault(); resetPassword();">
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="newPassword" name="newPassword"
                            placeholder="Create a strong password" required>
                        <button type="button" class="toggle-password" onclick="togglePw('newPassword', this)">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <span class="strength-text" id="strengthText"></span>
                    </div>
                    <ul class="password-requirements">
                        <li id="req-length"><i class="far fa-circle"></i> At least 8 characters</li>
                        <li id="req-upper"><i class="far fa-circle"></i> One uppercase letter</li>
                        <li id="req-number"><i class="far fa-circle"></i> One number</li>
                        <li id="req-special"><i class="far fa-circle"></i> One special character</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="confirmPassword" name="confirmPassword"
                            placeholder="Re-enter your password" required>
                        <button type="button" class="toggle-password" onclick="togglePw('confirmPassword', this)">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="resetBtn">Reset Password</button>
            </form>
        </div>

        <!-- STEP 4: Success -->
        <div class="step step-4" id="step4">
            <div class="success-check">
                <i class="fas fa-check"></i>
            </div>

            <div class="step-header">
                <h1>Password reset successful!</h1>
                <p>Your password has been updated. You can now sign in with your new password.</p>
            </div>

            <a href="evillage-signin.html" class="submit-btn"
                style="display: block; text-align: center; text-decoration: none;">
                <i class="fas fa-arrow-right"></i> Sign In
            </a>
        </div>
    </div>

    <script src="script.js?v=2.0"></script>
    <script>
        // --- Step Navigation ---
        function goToStep(n) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');

            // Update progress dots
            for (let i = 1; i <= 3; i++) {
                const dot = document.getElementById('dot' + i);
                dot.classList.remove('active', 'done');
                if (i < n) dot.classList.add('done');
                else if (i === n) dot.classList.add('active');
            }
        }

        // --- Step 1: Send Code ---
        function sendCode() {
            const email = document.getElementById('resetEmail').value;
            const btn = document.getElementById('sendBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            btn.disabled = true;

            setTimeout(() => {
                document.getElementById('emailDisplay').textContent = email;
                goToStep(2);
                startTimer();
                btn.innerHTML = 'Send Verification Code';
                btn.disabled = false;
            }, 1500);
        }

        // --- Step 2: OTP ---
        const otpInputs = document.querySelectorAll('.otp-input');
        otpInputs.forEach((input, i) => {
            input.addEventListener('input', (e) => {
                const val = e.target.value.replace(/[^0-9]/g, '');
                e.target.value = val;
                if (val && i < otpInputs.length - 1) {
                    otpInputs[i + 1].focus();
                }
                input.classList.toggle('filled', !!val);
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && i > 0) {
                    otpInputs[i - 1].focus();
                    otpInputs[i - 1].value = '';
                    otpInputs[i - 1].classList.remove('filled');
                }
            });
            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const text = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
                for (let j = 0; j < Math.min(text.length, 6); j++) {
                    otpInputs[j].value = text[j];
                    otpInputs[j].classList.add('filled');
                }
                if (text.length >= 6) otpInputs[5].focus();
            });
        });

        function verifyCode() {
            const code = Array.from(otpInputs).map(i => i.value).join('');
            if (code.length < 6) {
                otpInputs.forEach(i => { if (!i.value) i.style.borderColor = '#ef4444'; });
                return;
            }
            const btn = document.getElementById('verifyBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            btn.disabled = true;

            setTimeout(() => {
                goToStep(3);
                btn.innerHTML = 'Verify Code';
                btn.disabled = false;
            }, 1200);
        }

        let timerInterval;
        function startTimer() {
            let seconds = 30;
            const timerEl = document.getElementById('timer');
            const resendArea = document.getElementById('resendArea');

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds--;
                timerEl.textContent = `Resend in 0:${seconds.toString().padStart(2, '0')}`;
                if (seconds <= 0) {
                    clearInterval(timerInterval);
                    resendArea.innerHTML = `Didn't receive the code? <a href="#" onclick="event.preventDefault(); resendCode();">Resend code</a>`;
                }
            }, 1000);
        }

        function resendCode() {
            const resendArea = document.getElementById('resendArea');
            resendArea.innerHTML = '<i class="fas fa-check" style="color: #10b981;"></i> Code resent!';
            setTimeout(() => {
                resendArea.innerHTML = `Didn't receive the code? <span class="timer" id="timer">Resend in 0:30</span>`;
                startTimer();
            }, 2000);
        }

        // --- Step 3: New Password ---
        const newPw = document.getElementById('newPassword');
        newPw.addEventListener('input', checkStrength);

        function checkStrength() {
            const val = newPw.value;
            let score = 0;

            const hasLength = val.length >= 8;
            const hasUpper = /[A-Z]/.test(val);
            const hasNumber = /[0-9]/.test(val);
            const hasSpecial = /[^A-Za-z0-9]/.test(val);

            score = [hasLength, hasUpper, hasNumber, hasSpecial].filter(Boolean).length;

            // Update requirements
            toggleReq('req-length', hasLength);
            toggleReq('req-upper', hasUpper);
            toggleReq('req-number', hasNumber);
            toggleReq('req-special', hasSpecial);

            // Update bar
            const fill = document.getElementById('strengthFill');
            const text = document.getElementById('strengthText');
            const levels = [
                { w: '0%', c: '#e5e7eb', t: '' },
                { w: '25%', c: '#ef4444', t: 'Weak' },
                { w: '50%', c: '#f59e0b', t: 'Fair' },
                { w: '75%', c: '#3b82f6', t: 'Good' },
                { w: '100%', c: '#10b981', t: 'Strong' }
            ];
            fill.style.width = levels[score].w;
            fill.style.background = levels[score].c;
            text.textContent = levels[score].t;
            text.style.color = levels[score].c;
        }

        function toggleReq(id, met) {
            const el = document.getElementById(id);
            el.classList.toggle('met', met);
            el.querySelector('i').className = met ? 'fas fa-check-circle' : 'far fa-circle';
        }

        function togglePw(inputId, btn) {
            const input = document.getElementById(inputId);
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            btn.querySelector('i').className = isPassword ? 'far fa-eye-slash' : 'far fa-eye';
        }

        function resetPassword() {
            const pw = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (pw !== confirm) {
                document.getElementById('confirmPassword').style.borderColor = '#ef4444';
                return;
            }
            if (pw.length < 8) return;

            const btn = document.getElementById('resetBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            btn.disabled = true;

            setTimeout(() => {
                goToStep(4);
                // Hide progress dots on success
                document.querySelector('.progress-dots').style.display = 'none';
            }, 1500);
        }
    </script>
</body>

</html>